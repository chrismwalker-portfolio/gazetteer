"use strict";$(document).ready(function(){var l,D,O,S,A,s=void 0,I=void 0,E=void 0,M=void 0,G="Unavailable";$('[data-toggle="tooltip"]').tooltip();var d=new L.Map("gazetteerMap",{tap:!1}).setView([51.505,-.09],5);L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012",maxZoom:18}).addTo(d),$.ajax({type:"GET",url:"resources/php/getCountryList.php",dataType:"json",success:function(t){"OK"==t.status.result&&$.each(t.data,function(t,a){$("#countryDropdownList").append($("<option></option>").attr("value",a.iso2).attr("data-iso3",a.iso3).text(a.name))})}}),$.ajax({type:"GET",url:"resources/php/getCurrencyList.php",dataType:"json",success:function(t){"OK"==t.status.result&&($.each(t.data,function(t,a){$("#currencyFromDropdownList").add("#currencyToDropdownList").append($("<option></option>").attr({value:a.code,"data-name":a.name}).text(a.name+" ("+a.code+")"))}),$("#currencyFromDropdownList").val("GBP"))}});function c(){$("#preloader").length&&$("#preloader").fadeOut(500,function(){$(".map-help-button").attr("data-toggle")&&$(".map-help-button").tooltip("show")})}function e(){var t=void 0!==(a=(o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0]).iso2)&&a,a=void 0!==(e=o.country)&&e,e=void 0!==(e=o.lat)&&e,o=o.lng,o={country:a,iso2:t,lat:e,lng:void 0!==o&&o};$.ajax({type:"GET",url:"resources/php/getAllGeoData.php",data:o,dataType:"json",success:function(t){var a,e,o,r,n,i,l,s,d;"OK"==t.status.result?(a=t.openCage,e=t.here.results.items,o=t.restCountries,r=t.wikipediaText,n=t.wikipediaImages,i=t.openWeather,l=t.holidays,s=t.webcams,d=[[a.bounds.northeast.lat,a.bounds.northeast.lng],[a.bounds.southwest.lat,a.bounds.southwest.lng]],p(o,r,n,i,l,s),$("#countryDropdownList").val(a.components["ISO_3166-1_alpha-2"]),u(a.components["ISO_3166-1_alpha-2"],a.geometry.lat,a.geometry.lng,d,e)):(console.log(t),c(),$("#errorModal").modal("show"))}})}var u=function(t,a,e,o,n){d.eachLayer(function(t){t instanceof L.LayerGroup&&d.removeLayer(t)}),$.ajax({type:"GET",url:"resources/php/getCountryBorder.php",data:{iso2:t},dataType:"json",success:function(t){"OK"==t.status.result&&L.featureGroup([L.geoJSON(t.data,{color:"#4169E1",fillColor:"#0F417E",fillOpacity:"0.06"})]).addTo(d)}}),d.setView([a,e],13),d.fitBounds(o);var r,i=L.markerClusterGroup();for(r in n)!function(r){l=L.icon({iconUrl:n[r].icon,iconSize:[50,60]}),s="<strong>"+n[r].title+"</strong><br>\n                ("+n[r].category.title+")","openingHours"in n[r]&&(s+="<br><br>Opening Hours:<br>\n                "+n[r].openingHours.text),i.addLayer(L.marker(n[r].position,{icon:l}).bindTooltip(s,{className:"marker-tooltip"}).on("click",function(){$("#marker-carousel .carousel-indicators").empty(),$("#marker-carousel .carousel-inner").empty(),$("#marker-modal-body").children().addClass("hide"),$("#marker-modal-title").html(n[r].title+"<br>\n                        <em>("+n[r].category.title+")</em>"),"openingHours"in n[r]&&($("#marker-opening-hours").html("<strong>Opening Hours:</strong><br>"+n[r].openingHours.text),$("#marker-opening-hours").removeClass("hide")),$.ajax({type:"GET",url:"resources/php/getMarkerData.php",data:{hereMarkerUrl:n[r].href},dataType:"json",success:function(t){if("OK"==t.status.result){var a=t.data;if("address"in a.location&&($("#marker-address").html("<strong>Address:</strong><br>"+a.location.address.text),$("#marker-address").removeClass("hide")),"contacts"in a&&("phone"in a.contacts&&($("#marker-phone").html("<strong>Phone No:</strong><br>"+a.contacts.phone[0].value),$("#marker-phone").removeClass("hide")),"website"in a.contacts&&($("#marker-website").html("<strong>Website:</strong><br>\n                                            <a href='"+a.contacts.website[0].value+"' target='_blank'>"+a.contacts.website[0].value+"</a>"),$("#marker-website").removeClass("hide"))),"media"in a){var e=[];if("images"in a.media&&0<a.media.images.items.length){for(var o=0;o<=a.media.images.items.length-1;o++)e.push(a.media.images.items[o].src),I=0===o?"carousel-item active":"carousel-item",$("#marker-carousel .carousel-inner").append('<div class="'+I+'">\n                                                    <img \n                                                        src="'+a.media.images.items[o].src+'" \n                                                        class="d-block m-auto" \n                                                        alt="'+n[r].title+'" \n                                                        aria-label="'+n[r].title+'" \n                                                        data-attribution="'+_(a.media.images.items[o].attribution,"escape")+'">\n                                                </div>'),0===o?($("#marker-carousel .carousel-indicators").append('<li data-target="#marker-carousel" data-slide-to="'+o+'" class="active"></li>'),$("#marker-photo-attribution").html(a.media.images.items[o].attribution)):$("#marker-carousel .carousel-indicators").append('<li data-target="#marker-carousel" data-slide-to="'+o+'"></li>');1<a.media.images.items.length?$("#marker-carousel .carousel-indicators").add("#marker-carousel a").removeClass("hide"):$("#marker-carousel .carousel-indicators").add("#marker-carousel a").addClass("hide"),$("#marker-slideshow").removeClass("hide"),$("#preloader").fadeIn(300),m(e)}}$("#preloader").is(":visible")||$("#markerModal").modal("show")}}})}))}(r);d.addLayer(i),c()},p=function(t,a,e,o,r,n){$("#modal-card-country-flag").empty(),t.flags&&((u=$(document.createElement("img"))).attr("src",t.flags[0]),u.attr("alt","Flag of "+t.name),u.attr("aria-label","Flag of "+t.name),u.appendTo("#modal-card-country-flag"));var i,l=t.name||G,s=t.region||G,d=t.area?B(t.area)+" km<sup>2</sup>":G,c=t.capital||G,u=t.population?B(t.population):G,p="";$.each(t.borders,function(t,a){(i=$("#countryDropdownList option[data-iso3='"+a+"']:first").text())&&(p+=0!==t&&p?", "+i:i)}),p=p||"None";var m,h="";$.each(t.currencies,function(t,a){a.name&&a.code&&(m="symbol"in a&&a.symbol?a.name+" ("+a.symbol+")":a.name,0===t?(h+=m,$("#currencyToDropdownList").val(a.code)):h+=", "+m)}),h=h||G;var g="";$("#translateOutputDropdownList").empty(),$.each(t.languages,function(t,a){"en"!==a.iso639_1&&$("#translateOutputDropdownList").append($("<option></option>").attr("value",a.iso639_1).text(a.name)),g+=0===t?a.name:", "+a.name}),g=g||G;var y="";$.each(t.topLevelDomain,function(t,a){y+=0===t?""+a:", "+a}),y=y||G;var f="";if($.each(t.callingCodes,function(t,a){f+=0===t?"+"+a:", +"+a}),f=f||G,$("#country-modal-title").text(l),$("#modal-card-country-name").text(l),$("#modal-card-country-region").text(s),$("#modal-card-country-area").html(d),$("#modal-card-country-borders").text(p),$("#modal-card-country-capital").text(c),$("#modal-card-country-population").text(u),$("#modal-card-country-currency").text(h),$("#modal-card-country-language").text(g),$("#modal-card-country-domain").text(y),$("#modal-card-country-tel").text(f),$("#wiki-carousel").add("#wiki-carousel a").add("#modal-card-wiki-carousel-caption").addClass("hide"),$("#wiki-carousel .carousel-indicators").empty(),$("#wiki-carousel .carousel-inner").empty(),$("#modal-card-country-wikipedia").empty(),$("#modal-card-country-wiki-link").attr("href")&&($("#modal-card-country-wiki-link").removeAttr("href"),$("#modal-card-country-wiki-link").removeAttr("target"),$("#modal-card-country-wiki-link").empty()),e.query.pages){var b=e.query.pages,v=Object.keys(b).filter(function(t){return"-"===t[0]}),w=v.length<5?v.length-1:4;if(w){for(var k=0;k<=w;k++)100<(E="ImageDescription"in b[v[k]].imageinfo[0].extmetadata?b[v[k]].imageinfo[0].extmetadata.ImageDescription.value:"Caption unavailable").length&&100<(E=j(E)).length&&0<(D=E.indexOf(" ",100))&&(E=E.substring(0,D)+"....."),O="Artist"in b[v[k]].imageinfo[0].extmetadata?b[v[k]].imageinfo[0].extmetadata.Artist.value:G,S="LicenseShortName"in b[v[k]].imageinfo[0].extmetadata?b[v[k]].imageinfo[0].extmetadata.LicenseShortName.value:"",M=O&&S?O+", "+S+", via Wikimedia Commons":O,I=0===k?"carousel-item active":"carousel-item",$("#wiki-carousel .carousel-inner").append('<div class="'+I+'">\n                            <a href="'+b[v[k]].imageinfo[0].descriptionshorturl+'" target="_blank">\n                                <img \n                                    src="'+b[v[k]].imageinfo[0].thumburl+'" \n                                    class="d-block m-auto" \n                                    data-toggle="tooltip" \n                                    title="Click the image for more information" \n                                    alt="'+b[v[k]].title+'" \n                                    aria-label="'+b[v[k]].title+'" \n                                    data-caption="'+_(E,"escape")+'" \n                                    data-attribution="'+_(M,"escape")+'">\n                            </a>\n                        </div>'),0===k?($("#wiki-carousel .carousel-indicators").append('<li data-target="#wiki-carousel" data-slide-to="'+k+'" class="active"></li>'),$("#modal-card-wiki-carousel-caption").html(E+"<br>Attribution: "+M)):$("#wiki-carousel .carousel-indicators").append('<li data-target="#wiki-carousel" data-slide-to="'+k+'"></li>');0<w?$("#wiki-carousel .carousel-indicators").add("#wiki-carousel a").removeClass("hide"):$("#wiki-carousel .carousel-indicators").add("#wiki-carousel a").addClass("hide"),$("#wiki-carousel").add("#modal-card-wiki-carousel-caption").removeClass("hide")}}if(a&&a.extract_html?($("#modal-card-country-wikipedia").html(a.extract_html),a.content_urls.desktop.page&&($("#modal-card-country-wiki-link").attr("href",a.content_urls.desktop.page),$("#modal-card-country-wiki-link").attr("target","_blank"),$("#modal-card-country-wiki-link").append(a.content_urls.desktop.page))):$("#modal-card-country-wikipedia").append(G),o.daily&&4<=o.daily.length)for(var x=0;x<=3;x++)$("#forecast-icon-day-"+x).attr("src","https://openweathermap.org/img/wn/"+o.daily[x].weather[0].icon+"@2x.png"),$("#forecast-icon-day-"+x).attr("alt",o.daily[x].weather[0].description),$("#forecast-icon-day-"+x).attr("aria-label",o.daily[x].weather[0].description),$("#forecast-max-day-"+x).html(Math.round(o.daily[x].temp.max)+"&#176"),$("#forecast-min-day-"+x).html(Math.round(o.daily[x].temp.min)+"&#176"),1<x?(A=F(o.daily[x].dt),$("#forecast-title-day-"+x).text(A[0]+" "+A[1])):(0===x&&$("#forecast-title-day-"+x).text("Today"),1===x&&$("#forecast-title-day-"+x).text("Tomorrow"));else for(var T=0;T<=3;T++)$("#forecast-icon-day-"+T).removeAttr("src"),$("#forecast-icon-day-"+T).removeAttr("alt"),$("#forecast-icon-day-"+T).removeAttr("aria-label"),$("#forecast-max-day-"+T).text(""),$("#forecast-min-day-"+T).text(""),$("#forecast-title-day-"+T).text(G);$("#currency-results").children().addClass("hide"),$("#currencyAmountInput").val("1.00"),$("#currencyFromDropdownList").val("GBP"),$("#translateInputText").add("#translateOutputText").add("#translateOutputDropdownList").prop("disabled",!1),$("#translateInputText").add("#translateOutputText").val(""),$("#translate-char-limit").text("0 / 500"),$("#translateOutputText").attr("readonly","readonly"),$("#translate-button").prop("disabled",!0),$("#translateOutputDropdownList option").length<1&&($("#translateOutputDropdownList").append($("<option></option>").text("-- "+G+" --")),$("#translateInputText").add("#translateOutputText").val("Translation unavailable for English-speaking countries."),$("#translateOutputText").removeAttr("readonly"),$("#translateInputText").add("#translateOutputText").add("#translateOutputDropdownList").prop("disabled",!0));var L,C;$("#holidays-unavailable").hasClass("hide")&&$("#holidays-unavailable").removeClass("hide"),$("#holidays-table").hasClass("hide")||$("#holidays-table").addClass("hide"),$("#holidays-table tbody").empty(),0<r.length&&($.each(r,function(t,a){L=a.localName==a.name?a.localName:a.localName+" ("+a.name+")",C=encodeURI("https://en.wikipedia.org/wiki/"+a.name),$("#holidays-table tbody").append($("<tr></tr>").attr("data-id",t)),$("#holidays-table tbody").find("tr[data-id="+t+"]").append($("<td></td>").text(N(new Date(a.date)))).append($("<td></td>")),$("#holidays-table tbody").find("tr[data-id="+t+"]").children().last().append($("<a></a>").attr({href:C,target:"_blank"}).text(L))}),$("#holidays-unavailable").hasClass("hide")||$("#holidays-unavailable").addClass("hide"),$("#holidays-table").hasClass("hide")&&$("#holidays-table").removeClass("hide")),$("#webcam-0").add("#webcam-1").add("#webcam-2").addClass("hide"),$("#webcam-name-0").add("#webcam-name-1").add("#webcam-name-2").addClass("hide"),$("#webcams-unavailable").hasClass("hide")&&$("#webcams-unavailable").removeClass("hide"),n.data&&0<n.data.length?($.each(n.data,function(t,a){$("#webcam-"+t+" iframe").attr("src",a.url),$("#webcam-name-"+t+" p").text(a.name),$("#webcam-"+t).removeClass("hide"),$("#webcam-name-"+t).removeClass("hide")}),$("#webcams-unavailable").addClass("hide")):$("#webcams-unavailable p").text(n.status.error)};L.easyButton("map-button map-help-button fas fa-question",function(){$("#helpModal").modal("show")},"How to use Gazetteer").addTo(d),$(".map-help-button").attr("data-toggle","tooltip"),$(".map-help-button").attr("data-placement","right"),$(".map-help-button").attr("data-offset",[0,20]),$(".map-help-button").attr("title","START HERE"),$(".map-help-button").tooltip("enable"),L.easyButton("map-button fas fa-info",function(){$("#modal-card-general").modal("show")},"Show country information").addTo(d),L.easyButton("map-button fab fa-wikipedia-w",function(){$("#modal-card-wikipedia").modal("show")},"Show Wikipedia information").addTo(d);var t=[L.easyButton("map-button fas fa-sun",function(){$("#modal-card-weather").modal("show")},"Show weather forecast",{position:"topleft"}).addTo(d),L.easyButton("map-button fas fa-dollar-sign",function(){$("#modal-card-currency").modal("show")},"Show currency converter",{position:"topleft"}).addTo(d),L.easyButton("map-button far fa-comment",function(){$("#modal-card-translate").modal("show")},"Show language translation",{position:"topleft"}).addTo(d),L.easyButton("map-button far fa-calendar-alt",function(){$("#modal-card-holidays").modal("show")},"Show public holidays",{position:"topleft"}).addTo(d),L.easyButton("map-button fas fa-video",function(){$("#modal-card-webcams").modal("show")},"Show webcams",{position:"topleft"}).addTo(d)];navigator.geolocation.getCurrentPosition(function(t){var a=t.coords.latitude,t=t.coords.longitude;e({lat:a,lng:t})},function(t){e({iso2:"GB",country:"United Kingdom"})}),$(window).resize(function(){$(window).height()<550?"topright"!==t[0].options.position&&$.each(t,function(t,a){a.options.position="topright",a.addTo(d)}):"topleft"!==t[0].options.position&&$.each(t,function(t,a){a.options.position="topleft",a.addTo(d)})}),$(".map-help-button").on("shown.bs.tooltip",function(){$(".tooltip").addClass("tooltip-bounce-left")}),$(document).add(".easy-button-button").on("touchstart mousedown",function(){$(".map-help-button").tooltip("hide"),$(".map-help-button").removeAttr("data-toggle"),$(".map-help-button").removeAttr("data-placement"),$(".map-help-button").removeAttr("data-offset"),$(".map-help-button").removeAttr("title"),$(".map-help-button").tooltip("dispose"),$(document).add(".easy-button-button").off("touchstart mousedown")}),$("#countryDropdownList").change(function(){"default"!==$("#countryDropdownList option:selected").val()&&($("#preloader").fadeIn(500),e({iso2:$("#countryDropdownList").val(),country:$("#countryDropdownList option:selected").text()}))}),$("#currencyAmountInput").on("input",function(){$("#currency-results").children().addClass("hide"),a()}),$("#currency-convert-button").on("click",function(){var e,o,r;$("#currencyAmountInput").val()&&$("#currencyFromDropdownList").val()&&$("#currencyToDropdownList").val()&&(e=$("#currencyFromDropdownList option:selected"),o=$("#currencyToDropdownList option:selected"),r=$("#currencyAmountInput"),$.ajax({type:"GET",url:"resources/php/getExchangeRates.php",data:{from:e.val(),to:o.val(),amount:r.val()},dataType:"json",success:function(t){var a;"OK"==t.status.result&&t.data.exchangeResult?($("#currency-result-from-amount").text(""),$("#currency-result-from").html($("#currency-result-from-amount")),$("#currency-result-to-amount").text(""),$("#currency-result-to").html($("#currency-result-to-amount")),a=F(t.data.timestamp),$("#currency-result-from-amount").text(B(n(r.val(),5))+" "),$("#currency-result-from").html($("#currency-result-from").html()+($(e).attr("data-name")+" = ")),$("#currency-result-to-amount").text(B(t.data.exchangeResult)+" "),$("#currency-result-to").html($("#currency-result-to").html()+(""+$(o).attr("data-name"))),$("#currency-base-rate").text("1 "+e.val()+" = "+B(t.data.exchangeRate)+" "+o.val()),$("#currency-result-timestamp").text("Last updated "+a[0]+" "+a[1]+", "+a[2]+" (UTC)"),$("#currency-results").children().removeClass("hide")):($("#currency-result-from").text($("#modal-card-currency .modal-title").text()+" "+G),$("#currency-results .row").first().add("#currency-result-from").removeClass("hide"))}}))}),$("#translateInputText").on("input",function(){$("#translate-char-limit").text($("#translateInputText").val().length+" / 500"),$("#translate-button").prop("disabled",0===$("#translateInputText").val().length)}),$("#translate-button").on("click",function(){var t={translateText:$("#translateInputText").val(),translateToLang:$("#translateOutputDropdownList option:selected").val()};$.ajax({type:"GET",url:"resources/php/getTranslation.php",data:t,dataType:"json",success:function(t){"OK"==t.status.result?"translatedText"in t.data.responseData&&$("#translateOutputText").val(_(t.data.responseData.translatedText,"unescape")):$("#translateOutputText").val(t.status.error)}})}),$("#translate-copy").on("click",function(){0<$("#translateOutputText").val().length&&((t=document.getElementById("translateOutputText")).select(),t.setSelectionRange(0,99999),document.execCommand("copy"));var t=0<$("#translateOutputText").val().length&&!$("#translateOutputText").prop("disabled")?"Copied to clipboard":"Nothing to copy";$("#translate-copy").attr({"data-toggle":"tooltip","data-animation":!0,"data-placement":"left","data-offset":[0,10],"data-trigger":"manual","data-original-title":t,title:t}),$("#translate-copy").tooltip("enable").tooltip("show")}),$("#translate-copy").on("shown.bs.tooltip",function(){setTimeout(function(){$("#translate-copy").removeAttr("data-toggle data-animation data-placement data-offset data-trigger data-original-title title"),$("#translate-copy").tooltip("hide").tooltip("disable")},2e3)}),$("#currencyFromDropdownList, #currencyToDropdownList").change(function(){$("#currency-results").children().addClass("hide"),a()}),$("#marker-carousel").add("#wiki-carousel").on("slid.bs.carousel",function(t){var a=$(t.relatedTarget).contents().filter(function(){return 1===this.nodeType});"marker-carousel"===t.currentTarget.id?$("#marker-photo-attribution").html(a[0].dataset.attribution):"wiki-carousel"===t.currentTarget.id&&$("#modal-card-wiki-carousel-caption").html(a[0].children[0].dataset.caption+"<br>Attribution: "+a[0].children[0].dataset.attribution)});var _=function(t,a){return"escape"===a?String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"unescape"===a?String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'"):void 0},j=function(t){return t.replace(/(<([^>]+)>)/gi,"")},B=function(t){t=t.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},N=function(t){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()]+", "+(1===t.getDate().toString().length?"0"+t.getDate():t.getDate())+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getFullYear().toString().substr(-2)},n=function(t,a){return+(Math.round(t+"e+"+a)+"e-"+a)},F=function(t){t=new Date(1e3*t);return[t.getDate(),t.toLocaleString("en-GB",{month:"long"}),(t.getUTCHours()<10?"0":"")+t.getUTCHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()]},a=function(){!$("#currencyAmountInput").val()||$("#currencyAmountInput").val()<1||!$("#currencyFromDropdownList").val()||!$("#currencyToDropdownList").val()?$("#currency-convert-button").prop("disabled",!0):$("#currency-convert-button").prop("disabled",!1)},m=function(e){var o=void 0;$.each(e,function(t,a){(o=new Image).onload=function(){t===e.length-1&&(c(),$("#markerModal").modal("show"))},o.src=a})}});